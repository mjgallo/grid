{% load humanize %}
{% load my_app_filters %}
<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Grid</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="/static/grid/jquery-1.10.2.js" type="text/javascript"></script>

	<!--<script src="/static/grid/jquery.jeditable.js" type="text/javascript"></script>
<script src="/static/grid/custom.js" type="text/javascript"></script>
-->
	
    <!-- Bootstrap -->
    <link href="/static/bootstrap/css/bootstrap.css" rel="stylesheet" media="screen" type="text/css">
    <link href="/static/bootstrap/css/bootstrap-extensions.css" rel="stylesheet" media="screen" type="text/css">
    <link href="/static/bootstrap-editable/css/bootstrap-editable.css" rel="stylesheet" type="text/css">
	<script src="/static/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/bootstrap-editable/js/bootstrap-editable.js"></script>
    <script src="/static/grid/address.js"></script>
    <script src="/static/bootstrap/js/bootstrap-tooltip.js"></script>
    <script src="/static/bootstrap/js/bootstrap-popover.js"></script>
    <!-- custom stuff -->
    <script src="/static/grid/myscript.js"></script>
    <script src="/static/grid/usertable.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/grid/mystyle.css">	

    <!-- GOOGLE MAPS JAVASCRIPT AND CSS AND MY CUSTOM-->
    <link href="http://code.google.com//apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css"> 
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCvkcMtW6Hd560BYcB2MTKS4L-yXUpZ7as&sensor=false&libraries=places,visualization&v=3.exp"></script>
    <script src="/static/grid/locationsearch.js"></script>

<!-- ACTUAL HTML-->
</head>
<div style="height:20px"></div>
<div style="text-align:right"><a style="margin-right:80px" href="http://127.0.0.1:8000/logout/">logout</a></div>
<div style="display:inline-block;width:60px"></div>
<h1 style="display:inline-block">welcome {{ this_user.username }}</h1>
<div style="height:30px"></div>
<div style="width:60px;display:inline-block"></div>

<form id="newfilter" class="form-search custom-search" style="margin-top:10px;margin-bottom:10px;display:inline-block" method="post" autocomplete="off" action="/grid/sort/">
  <input type="text" id="new-filter-search-params" placeholder="Filter by postcode" class="input-medium search-query" name="filtername">
  <button id="submit-button" type="submit" class="btn btn-primary"><i class="icon-search"></i></button>
</form>	


<!-- TABLE DIV BEGINS HERE-->

<div style="margin-left:60px; margin-right:60px; margin-bottom:60px">
<table class="table table-bordered" style="table-layout:fixed"> 
	<thead class=tablehead>

		<tr style="height:15px">
			<th style="width:140px;max-width:140px"> </th>
			{% for user in all_users %}
			<th style="width:140px;max-width:140px">
				<p style="display:inline-block;text-align:left">{{ user.username }}</p>
				{% if user != this_user %}
				<button type="button" id={{ user.pk }} class="close remove-user" data-dismiss="modal" aria-hidden="true" >×</button>
				{% endif %}
			</th>
			{% endfor %}
			<th style="width:140px;max-width:140px;text-align:center"><a href="#myModal" id="addfriend" role="button" class="btn btn">Add a friend</a>
			</th>
		</tr>
	</thead>
	<tbody>
	{% if not table_data %}
		<tr>
			<td colspan=2>Search for restaurants below to start adding reviews</td>
			<td></td>
		</tr>

	{% else %}
	{% for restaurant in table_data %}
		<tr class="rows">
			<td style="width:120px">
				<a href="#" id="tester" rel="popover" class="showmap" data-toggle="popover" data-location={{ restaurant.0.restaurant.address|spacify }},{{ restaurant.1.restaurant.post_code.name|spacify }}>
					<b>{{ restaurant.0.restaurant.name }}<br> {{ restaurant.0.restaurant.post_code.name }}</b>{% if restaurant.0.restaurant.distance %}<br> {{ restaurant.0.restaurant.distance.km|floatformat:"1"|intcomma }}km away{% endif %}</a>
					{% if restaurant.0.restaurant.telephone %}
					<p>{{ restaurant.0.restaurant.telephone }}</p>
					{% endif %}
					{% if restaurant.0.restaurant.website %}
					<a href={{ restaurant.0.restaurant.website }} target='_blank'>Website</a>
					{% endif %}

			</td>
			{% for user_review in restaurant %}
			<td class="reviewbox">
				<div class="generalreviewdiv">
					<div class={% if user_review.review and user_review.good %}
						review_exists_good
						{% elif user_review.review and not user_review.good %}
						review_exists_bad
						{% else %}
						no_review
						{% endif %}
					>

						<div href=# 	
							id={% if user_review.review %}{{ user_review.id }}{% else %}{{ user_review.reviewer.id }}-{{ user_review.restaurant.id }} {% endif %}

							data-type="textarea"
							data-pk="1"
							data-url="/grid/update/"
							data-title="Write a review"

						 	class={% if user_review.reviewer == this_user %}
						 			edit
						 			{% endif %} 
						 			name={{ user_review.id}}
						 	align="left"
						>

						{% if user_review.review %}{{ user_review.review }}
						{% elif user_review.reviewer == this_user %} Add your review! 
						{% else %}	
						{% endif %}
						</div>
					</div>
				</div>
			</td>
			{% endfor %}
			<td class="reviewbox">
			</td>
		</tr>
	{% endfor %}
	{% endif %}
	<tr id="searchrow">
		<td id="searchbox" colspan=2 style="width:280px;max-width:280px">

<form id="newrestsearch" class="form-search custom-search" style="margin-top:10px;margin-bottom:10px">
  <input type="text" id="new-rest-search-params" placeholder="Add a restaurant" class="input-medium search-query">
  <button id="submit-button" type="submit" class="btn btn-primary"><i class="icon-search"></i></button>
</form>	
<div id="searchresults" style="display:none"></div>

		</td>
		<td colspan={{ all_users|length }}>
			<div id="map-canvas" style="display:none;height:338px;width:338px"></div>
		</td>

	</tr>
	</tbody>
</table>
<div style="float:right; width:25%" ></div>
<div style="height:60px"></div>
<!-- Modal -->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">Add friends to your grid</h3>
  </div>
  <div class="modal-body" id="modal-content">

  	<form id="newfriendsearch" class="form-search custom-search" style="margin-top:10px;margin-bottom:10px" method="post">
  <input type="text" id="friendsearchparams" placeholder="Look for a friend" class="input-medium search-query">
  <button id="submit-button3" type="submit" class="btn btn-primary"><i class="icon-search"></i></button>
</form>	
  	    <table id="usertable" class="table table-condensed table-hover">

      <thead>
        <tr>
          <th>#</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Username</th>
          <th style="width: 36px;"></th>
        </tr>
      </thead>
      <tbody id="tbody">
      </tbody>
    </table>

  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>
</html>